// Generated by generate.go; do not edit manually
package database

import (
	"subLease/src/server/domain"
)

{{ $pascalCased := .Entity | PascalCase }}

type {{ $pascalCased }}Update struct {
{{- range .Fields }}
    {{ .Identifier }} *{{ .TypeDeclaration -}}
{{ end }}
}

func ({{ .Abbreviation }} *{{ $pascalCased }}Update) Update{{ $pascalCased }}WithValuesFrom(e domain.{{ $pascalCased }}, database Database) (domain.{{ $pascalCased }}, error) {
{{- range .Fields }}
    if {{ $.Abbreviation }}.{{ .Identifier }} != nil {
    {{- if .IsDomainEntity }}
        {{ if . | IsSliceType }}
            e.{{ .Identifier | Capitalize }} = database.Get{{ .Identifier | PascalCase }}ById(*{{ $.Abbreviation }}.{{ .Identifier }})
            if len(e.{{ .Identifier | Capitalize }}) != len(*{{ $.Abbreviation }}.{{ .Identifier }}) {
                return domain.{{ $pascalCased }}{}, errors.New("not all ids in {{ $.Abbreviation }}.{{ .Identifier }} found") // TODO: List the ids that weren't found
            }
        {{ else }}
		if {{ .Identifier | Decapitalize }}, found := database.Get{{ .Identifier | Capitalize }}(*{{ $.Abbreviation }}.{{ .Identifier | Capitalize }}); found {
            e.{{ .Identifier | Capitalize }} = {{ .Identifier | Decapitalize }}
		} else {
		    return domain.{{ $pascalCased }}{}, errors.New(fmt.Sprintf("referential integrity on {{ .Identifier | Capitalize }} not upheld. No {{ .Identifier | Capitalize }} with id %d found", *{{ $.Abbreviation }}.{{ .Identifier | Capitalize }}))
		}
        {{ end }}
    {{- else }}
		e.{{ .Identifier }} = *{{ $.Abbreviation }}.{{ .Identifier }}
    {{- end }}
    }
{{- end }}
    return e, nil
}

